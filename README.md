# AI 复习问答系统（基于通义千问 / DashScope）

这是一个面向 AI 的本地复习问答系统：

- 上传自己的学习笔记（Markdown / TXT 等），
- 由通义千问（DashScope）自动生成单选题 + 简答题，
- 通过对话式刷题实时给出评分与解析，
- 记录错题并支持集中复习，
- 提供按周统计的正确率可视化面板。

> 仅依赖 Flask + SQLite + DashScope API

---

## 1. 环境准备

### 1.1 克隆项目

```bash
git clone https://github.com/your-name/your-repo.git
cd your-repo
```

### 1.2 创建虚拟环境并安装依赖

```bash
python -m venv venv
# Windows PowerShell
venv\\Scripts\\activate

pip install -r requirements.txt
```

> 依赖主要包括：`flask`、`python-dotenv`、`requests`。

### 1.3 配置 DashScope API Key

1. 在项目根目录创建 `.env` 文件（也可以复制 `.env.example` 重命名为 `.env`）。
2. 填写你的通义千问 / DashScope API Key：

```env
DASHSCOPE_API_KEY=你的-dashscope-api-key
```

---

## 2. 启动应用

确保虚拟环境已激活，并在项目根目录执行：

```bash
python app.py
```

默认会在本机启动开发服务器：

- 访问首页（上传笔记）：http://127.0.0.1:5000/
- 对话练习页： http://127.0.0.1:5000/practice
- 错题本：      http://127.0.0.1:5000/wrong
- 数据面板：    http://127.0.0.1:5000/dashboard

---

## 3. 功能介绍

### 3.1 上传笔记并生成题目

入口：`/`（首页）

- 支持上传 Markdown / TXT 文本文件。
- 可配置：
  - 题型：单选题（single_choice）、简答题（short_answer），可多选；
  - 题量：最大题目数（可选）。
- 后端会调用通义千问：
  - 自动从笔记中抽取知识点；
  - 生成题目（题干、选项、标准答案、解析等）；
  - 按题干去重，避免重复题。
- 每次上传会在数据库中记录为一个「模块」，后续练习可以按模块选择题源。

右侧「题库管理」区：

- 显示最近的笔记模块列表；
- 支持前端一键删除模块（会同时删除该模块下的题目和作答记录）。

### 3.2 对话式刷题练习

入口：`/practice`

- 类似聊天对话的刷题体验：一题一答，答完立即反馈：
  - 题目内容；
  - 你的作答；
  - 是否正确 / 得分；
  - 标准答案与解析；
  - 简答题由通义千问评分并给出中文点评（0~100 分，内部用 0~1 存储）。
- 可配置：
  - 题源模块：全部模块 / 最新模块 / 指定模块；
  - 题型过滤：仅单选、仅简答或全部；
  - 本轮题量：一次抽取的题目数；
- 抽题时默认随机打乱顺序，保证每轮练习题目顺序不同。

### 3.3 错题本

入口：`/wrong`

- 自动收集你历史答错的题目；
- 显示：题干、选项、标准答案、解析；
- 方便集中回顾薄弱知识点。

### 3.4 数据可视化面板

入口：`/dashboard`

- 展示总体数据：
  - 总答题数、正确数、总体正确率；
- 按周统计正确率：
  - 以周为粒度（基于答题时间 week = `strftime('%Y-%W', created_at)`）；
  - 折线图展示每周正确率变化趋势，直观看到近期学习效果变化。

---

## 4. 与通义千问 / DashScope 的集成说明

所有调用封装在 `dashscope_client.py` 中（客户端类名为 `DashScopeClient`）：

- `generate_questions_from_note(note_text, question_types, max_questions)`
  - 输入一段笔记文本；
  - 模型自动：
    - 提炼每道题的 `knowledge_tag`；
    - 按配置生成单选题 / 简答题；
  - 单选题约束：
    - 选项数为 4~6 个，形如：`"A. 选项1"`、`"B. 选项2"`；
    - `answer` 字段只写字母：`"A" / "B" / ...`；
    - 且必须且只能有一个正确选项，避免「没有正确答案」。

- `score_answer(question, user_answer)`
  - 仅用于简答题评分；
  - 模型根据题干、知识点与参考答案，对用户作答进行 0~1 评分，并返回中文点评；
  - 后端将其转换为 0~100 分，并以 60 分为默认及格线（可按需要调整）。

> 如果你要迁移到其他大模型供应商，只需改写 `dashscope_client.py` 里的请求与解析逻辑，Flask 其他部分基本不用动。

---

## 5. 数据存储说明

项目使用 SQLite 作为本地数据库，默认文件为 `data.db`：

- `notes`：记录每次上传的笔记（模块）；
- `questions`：记录题目（含模块、知识点、题型、选项、答案、解析等）；
- `user_answers`：记录每次作答（题目 ID、用户答案、是否正确、时间戳）。

> 数据库和上传的原始笔记文件都默认被 `.gitignore` 忽略，不会被提交到仓库。

---

## 6. 生产环境 / 部署建议（可选）

本项目主要面向本地使用和示例用途，如果希望对外部署：

- 建议使用 gunicorn / uwsgi + Nginx 进行反向代理；
- 开启 HTTPS，妥善保护 API Key 与用户数据；
- 视需求增加用户体系（登录态），并按用户维度区分错题本与统计数据。

---

